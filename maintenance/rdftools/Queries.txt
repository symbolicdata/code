##################################
#
# author: graebe
# createdAt: 2014-03-05
# lastUpdate: 2014-03-05

# purpose: Examples of SPARQL Queries.  Feel free to enlarge the list of
# examples.

# In general: Load the required data into a local data store and perform the
# queries or use our SPARQL Endpoint at http://symbolicdata.org:8890/sparql

# =================================
List of useful prefixes

PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX org: <http://www.w3.org/ns/org#>
PREFIX sd: <http://symbolicdata.org/Data/Model#> 
PREFIX sdp: <http://symbolicdata.org/Data/People/> 
PREFIX sdpol: <http://symbolicdata.org/Data/PolynomialSystems/> 
PREFIX ical: <http://www.w3.org/2002/12/cal/ical#> 

# =================================
# Quality Checks

-- Are the listed People in the SD People Database?

select ?p ?name ?b 
from <http://symbolicdata.org/Data/UpcomingConferences/>
from <http://symbolicdata.org/Data/People/>
where {
?a ?b ?p .
optional {?p a foaf:Person; foaf:name ?name .} 
filter regex(?p, "Data/Person")
} order by desc(?p) 

-- Are the sd:Reference dct:creator values in sd:People?

PREFIX dcterms: <http://purl.org/dc/terms/> 
PREFIX sd: <http://symbolicdata.org/Data/Model#>
select 
distinct ?c ?n
where {
?p a sd:Reference; dcterms:creator ?c .
optional { ?c foaf:name ?n . }
filter (!bound(?n))
}

-- Do the sd:Annotation sd:relatesTo values exist?

PREFIX sd: <http://symbolicdata.org/Data/Model#>
select distinct ?p ?c ?t
where {
?p a sd:Annotation; sd:relatesTo ?c .
optional { ?c a ?t . }
filter (!bound(?t))
}
order by ?p

-- Explore duplicate URIs

select ?a ?b ?c 
where {
?a ?b ?c .
filter (
  ?c=<http://symbolicdata.org/Data/Person/Moura_LD> || 
  ?c=<http://symbolicdata.org/Data/Person/deMoura_L> )
}

select ?a ?b ?c 
where {
?a ?b ?c .
filter regex(?c,"http://symbolicdata.org/Data/Person/Gerdt_V")
}

-- Find entries with more than one foaf:name

PREFIX sd: <http://symbolicdata.org/Data/Model#> 
SELECT distinct ?l
from <http://symbolicdata.org/Data/People/>
WHERE {
  ?l a foaf:Person .
  ?l sd:affiliation ?n .
}
HAVING( count(?n)>1)
order by ?l

foaf:name
sd:affiliation
sd:country
foaf:homepage

# =================================
# Different Tasks

--  Extract all information about sd:Contributors

PREFIX sd: <http://symbolicdata.org/Data/Model#> 
construct { ?a ?b ?c . }  WHERE {
  ?a a sd:Contributor .
  ?a ?b ?c
}

--  List all Birkhoff Polytopes 

PREFIX sd: <http://symbolicdata.org/Data/Model#> 
select distinct ?a
from <http://symbolicdata.org/Data/BirkhoffPolytopes/>
where {
?a a sd:BirkhoffPolytope  .
}

-- count all sd:References
PREFIX sd: <http://symbolicdata.org/Data/Model#> 
select count(distinct ?a) 
where {
?a a sd:Reference .
}

-- count all sd:References that have a ZBentry
PREFIX sd: <http://symbolicdata.org/Data/Model#> 
select count(distinct ?a) 
where {
?a a sd:Reference .
?a sd:hasZBentry ?b .
}

-- List polynomial configurations by fingerprints

PREFIX sd: <http://symbolicdata.org/Data/Model#> 
select distinct ?ll ?dl count(?a) 
from <http://symbolicdata.org/Data/PolynomialSystems/>
where {
?a a sd:Ideal . 
?a sd:hasLengthsList ?ll . 
?a sd:hasDegreeList ?dl . 
} order by desc(count(?a))

PREFIX sd: <http://symbolicdata.org/Data/Model#> 
select ?a 
from <http://symbolicdata.org/Data/PolynomialSystems/>
where {
?a a sd:Ideal . 
?a sd:hasLengthsList "4,4,4" . 
?a sd:hasDegreeList "3,3,3" . 
} 

-- Find all transformation operations between ideal configurations

PREFIX sd: <http://symbolicdata.org/Data/Model#> 
select distinct ?p 
from <http://symbolicdata.org/Data/PolynomialSystems/>
where {
?a a sd:Ideal . 
?b a sd:Ideal . 
?a ?p ?b .
}

-- Annotations

PREFIX sd: <http://symbolicdata.org/Data/Model#> 
select ?a 
from <http://symbolicdata.org/Data/Annotations/>
where {
?a a sd:Annotation . 
?a sd:relatesTo <http://symbolicdata.org/Data/Ideal/Sym1_211> .
}

-- TestSets, list rdfs:label

PREFIX sd: <http://symbolicdata.org/Data/Model#>
select 
distinct ?p ?l
where {
?p a sd:TestSet; rdfs:label ?l .
}
order by ?p

# =================================
# ZBMath Stuff

# -- Find References not bound to a ZBMath entry

PREFIX dcterms: <http://purl.org/dc/terms/>
PREFIX sd: <http://symbolicdata.org/Data/Model#> 
PREFIX foaf: <http://xmlns.com/foaf/0.1/> 
select ?a ?t count(distinct ?cn)
where {
?a a sd:Reference .
optional { ?a dcterms:title ?t . }
optional { ?a dcterms:creator ?c . 
  ?c foaf:name ?cn . }
optional { ?a sd:hasZBentry ?b . }
filter (!bound(?b)) 
}

# -- List ZBMath Person correspondence to check it for plausibility

PREFIX sd: <http://symbolicdata.org/Data/Model#>
select ?a ?n ?s
from <http://symbolicdata.org/Data/ZBMathPeople/>
from <http://symbolicdata.org/Data/People/>
where {
?a sd:hasZMathSearchString ?s .
optional { ?a foaf:name ?n . }
} order by ?n

# -- List sd:Person without ZMathSearchString

PREFIX sd: <http://symbolicdata.org/Data/Model#>
select  ?a ?n
from <http://symbolicdata.org/Data/ZBMathPeople/>
from <http://symbolicdata.org/Data/People/>
where {
?a a foaf:Person .
?a foaf:name ?n .
optional { ?a sd:hasZMathSearchString ?s . }
filter (!bound(?s))
} 

# -- Check ZBMath Paper correspondence

PREFIX sd: <http://symbolicdata.org/Data/Model#>
PREFIX dcterms: <http://purl.org/dc/terms/> 
select ?a count(?c) as ?na ?t xsd:date(?y)
from <http://symbolicdata.org/Data/Bibliography/>
where {
?a a sd:Reference .
optional { ?a dcterms:creator ?c . }
optional { ?a dcterms:title ?t . }
optional { ?a dcterms:issued ?y . }
optional { ?a sd:hasZBentry ?s . }
filter (!bound(?s))
} order by ?a

